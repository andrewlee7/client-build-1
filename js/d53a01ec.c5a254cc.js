(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["d53a01ec"],{"40c0":function(t,e,r){"use strict";r.d(e,"a",function(){return a});r("a481");var a={methods:{delete:function(){var t=this;this.$q.dialog({title:"Are you sure you want to delete ".concat(this.title,"?"),ok:"Delete",cancel:"Cancel"}).then(function(e){t.$apollo.mutate({mutation:t.deleteMutation,variables:{id:t.itemId}}).then(function(e){t.$q.notify({message:"".concat(t.title," was deleted sucessfully"),type:"negative"});var r=t.deleteRoute||t.$route.meta.backRoute;t.$router.replace("/".concat(r))})}).catch(function(){})}}}},"41e2":function(t,e,r){},"7d7e":function(t,e,r){"use strict";r.d(e,"a",function(){return o});var a=r("5640"),s=r.n(a),i=r("9530"),n=r.n(i);function c(){var t=s()(["\n  mutation ConvertImageMutation($key: String!, $tag: String!, $width: Int!){\n    convertImage(\n      key: $key\n      tag: $tag\n      width: $width\n    ){\n      success\n      error\n      info\n    }\n  }\n"]);return c=function(){return t},t}var o=n()(c())},"8f52":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("q-page",[r("loading",{attrs:{query:t.$apollo.queries.resource}},[t.resource&&t.resource.reviews&&t.resource.reviews.length?[r("div",{staticClass:"text-center q-mt-sm show-reviews"},[r("h4",{staticStyle:{"margin-bottom":"0"}},[t._v(t._s(t.numReviews))]),r("div",{staticClass:"rating-display"},[r("q-rating",{staticClass:"text-center q-pt-md q-pb-md q-pr-md",attrs:{readonly:"",max:5},model:{value:t.rating,callback:function(e){t.rating=e},expression:"rating"}}),r("div",{staticClass:"q-pb-md"},[t._v(t._s(parseFloat(Math.round(100*t.rating)/100).toFixed(1))+" of 5 stars")])],1),r("div",{staticClass:"ratings-breakdown q-px-md q-pb-lg relative-position row"},[r("div",{staticClass:"label"},[t._v("5 Stars")]),r("div",{staticClass:"value q-pl-md q-pb-xs"},[r("q-progress",{staticStyle:{"border-radius":"3px",margin:"4px 0"},attrs:{percentage:t.resource.percent5star,height:"10px",color:"warning"}})],1),r("div",{staticClass:"label"},[t._v("4 Stars")]),r("div",{staticClass:"value q-pl-md q-pb-xs"},[r("q-progress",{staticStyle:{"border-radius":"3px",margin:"4px 0"},attrs:{percentage:t.resource.percent4star,height:"10px",color:"warning"}})],1),r("div",{staticClass:"label"},[t._v("3 Stars")]),r("div",{staticClass:"value q-pl-md q-pb-xs"},[r("q-progress",{staticStyle:{"border-radius":"3px",margin:"4px 0"},attrs:{percentage:t.resource.percent3star,height:"10px",color:"warning"}})],1),r("div",{staticClass:"label"},[t._v("2 Stars")]),r("div",{staticClass:"value q-pl-md q-pb-xs"},[r("q-progress",{staticStyle:{"border-radius":"3px",margin:"4px 0"},attrs:{percentage:t.resource.percent2star,height:"10px",color:"warning"}})],1),r("div",{staticClass:"label"},[t._v("1 Star")]),r("div",{staticClass:"value q-pl-md"},[r("q-progress",{staticStyle:{"border-radius":"3px",margin:"4px 0"},attrs:{percentage:t.resource.percent1star,height:"10px",color:"warning"}})],1)])]),r("scroll",{staticClass:"show-reviews",staticStyle:{top:"280px","border-top":"1px solid #ddd","padding-bottom":"24px"}},[r("q-pull-to-refresh",{attrs:{handler:t.refresher}},[r("q-list",{staticStyle:{"padding-top":"16px"},attrs:{separator:""}},t._l(t.resource.reviews,function(e){return r("q-item",{key:e.id,staticStyle:{"align-items":"flex-start",background:"#fff"}},[r("q-item-side",{staticStyle:{"padding-right":"24px","padding-top":"16px"}},[r("q-item-tile",{attrs:{avatar:""}},[e.user.avatar?r("aws-image",{staticClass:"avatar toolbar-avatar",attrs:{src:e.user.avatar}}):r("q-icon",{attrs:{name:"person",size:"30px"}})],1)],1),r("q-item-main",[r("q-item-tile",[r("span",{staticStyle:{"font-weight":"700",color:"#FF8310","font-size":"15px",position:"relative",top:"2px","margin-right":"4px"}},[t._v(t._s(parseFloat(Math.round(100*e.rating)/100).toFixed(1)))]),r("q-rating",{staticStyle:{padding:"0",margin:"4px 0",transform:"scale(0.7)","transform-origin-x":"left"},attrs:{readonly:"",max:5},model:{value:e.rating,callback:function(r){t.$set(e,"rating",r)},expression:"review.rating"}})],1),r("q-item-tile",{attrs:{sublabel:""}},[t._v(t._s(e.user.name))]),r("q-item-tile",{staticClass:"q-caption",attrs:{sublabel:""}},[t._v(t._s(t._f("toDateString")(e.updatedAt)))]),r("q-item-tile",{staticClass:"q-subheading q-pt-sm q-pb-md"},[t._v(t._s(e.description))])],1),t.isAdmin?r("q-item-side",{staticStyle:{"padding-right":"24px","padding-top":"16px"}},[r("q-item-tile",{attrs:{avatar:""}},[r("q-btn",{attrs:{flat:"",icon:"delete",size:"30px"},on:{click:function(r){t.deleteReview(e.id)}}})],1)],1):t._e()],1)}))],1)],1)]:r("transition",{attrs:{"enter-active-class":"animated fadeIn",appear:""}},[r("q-alert",{staticClass:"q-mb-sm",attrs:{color:"info",icon:"error",appear:""}},[t._v("\n        There are no reviews yet for this resource, click below to add one.\n      ")])],1)],2),r("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[r("q-fab",{staticClass:"white",attrs:{color:"primary",icon:"fa fa-pen"},on:{show:function(e){t.createReview()}}})],1)],1)},s=[];a._withStripped=!0;r("7f7f");var i=r("3156"),n=r.n(i),c=r("2743"),o=r("40c0"),u=r("2f62"),l=r("de9e"),p=r("0544"),d=r("fcab"),h={name:"ReviewList",mixins:[c["a"],o["a"]],components:{awsImage:d["a"]},data:function(){return{resource:null,rating:2.3,title:"this review",deleteMutation:p["b"],itemId:null}},beforeDestroy:function(){this.pageMeta()},methods:n()({deleteReview:function(t){console.log(this.DELETE_REVIEW_MUTATION),this.itemId=t,this.delete()},refresher:function(t){this.$apollo.queries.resource.refetch(),setTimeout(function(){t()},500)},createReview:function(){this.lastRoute||this.$store.commit("app/setLastRoute",[]),this.lastRoute.push(this.$route.path),this.$router.push(this.createReviewPath)}},Object(u["b"])({pageMeta:"app/setPageMeta"})),computed:n()({createReviewPath:function(){var t=this.resource.reviews.filter(function(t){return t.mine})[0];return t?"/curricula/".concat(this.$route.params.id,"/reviews/").concat(t.id):"/curricula/".concat(this.$route.params.id,"/reviews/new")},numReviews:function(){return 1===this.resource.reviews.length?"1 Review":"".concat(this.resource.reviews.length," Reviews")}},Object(u["c"])("app",["lastRoute"])),apollo:{resource:{query:l["s"],fetchPolicy:"cache-and-network",variables:function(){return{id:this.$route.params.id}},result:function(t){var e=t.data;e&&e.resource&&(this.rating=e.resource.rating,this.pageMeta({title:"Reviews",subtitle:e.resource.title}),"add_review"===this.$route.name&&this.$router.push(this.createReviewPath))}}}},g=h,m=(r("9996"),r("2877")),v=Object(m["a"])(g,a,s,!1,null,null,null);v.options.__file="ReviewList.vue";e["default"]=v.exports},9996:function(t,e,r){"use strict";var a=r("e423"),s=r.n(a);s.a},bd43:function(t,e,r){"use strict";var a=r("41e2"),s=r.n(a);s.a},e423:function(t,e,r){},fcab:function(t,e,r){"use strict";var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"fill"},[t.imageUrl?r("img",{attrs:{src:t.imageUrl}}):t._e()])},s=[];a._withStripped=!0;r("96cf");var i=r("c973"),n=r.n(i),c=(r("c5f6"),r("9755")),o=r("d67a"),u=r("7d7e"),l={name:"awsImage",props:{src:Object,default:String,expires:{type:Number,default:86400},tag:String,imageWidth:Number},methods:{tokenExpired:function(){var t=n()(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["a"].dispatch("getCurrentSession");case 2:if(e=t.sent.getAccessToken().getJwtToken(),this.$store.state.app.jwtToken!==e){t.next=5;break}return t.abrupt("return",!1);case 5:return this.$store.dispatch("app/setJwtToken",e),t.abrupt("return",!0);case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),cachedUrl:function(){var t=n()(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.src.url){t.next=2;break}return t.abrupt("return",this.src.url);case 2:return t.next=4,this.tokenExpired();case 4:if(!t.sent){t.next=7;break}return this.$store.dispatch("app/clearAwsCache"),t.abrupt("return");case 7:return t.abrupt("return",this.$store.getters["app/getAwsUrl"](this.awsSecret));case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),generateThumbnail:function(){var t=n()(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$apollo.mutate({mutation:u["a"],variables:{key:this.src.secret,tag:this.tag,width:this.imageWidth}});case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},computed:{isThumbnail:function(){return!!(this.src.secret&&this.tag&&this.imageWidth)},awsSecret:function(){return this.isThumbnail?"".concat(this.src.secret,"_").concat(this.tag):this.src.secret}},asyncComputed:{imageUrl:function(){var t=n()(regeneratorRuntime.mark(function t(){var e,r,a,s,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.src){t.next=2;break}return t.abrupt("return",this.default);case 2:return t.next=4,this.cachedUrl();case 4:if(e=t.sent,!e){t.next=7;break}return t.abrupt("return",e);case 7:if(!this.awsSecret){t.next=24;break}if(a=this.awsSecret,!this.isThumbnail){t.next=18;break}return t.next=12,c["a"].list(this.awsSecret);case 12:if(s=t.sent,s.length){t.next=18;break}return t.next=16,this.generateThumbnail();case 16:i=t.sent,i&&i.data&&i.data.convertImage&&i.data.convertImage.success||(a=this.src.secret);case 18:return t.next=20,c["a"].get(a,{expires:this.expires});case 20:return e=t.sent,r=(new Date).getTime()+1e3*(this.expires-60),this.$store.dispatch("app/cacheAwsUrl",{key:this.awsSecret,expiration:r,url:e}),t.abrupt("return",e);case 24:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},p=l,d=(r("bd43"),r("2877")),h=Object(d["a"])(p,a,s,!1,null,null,null);h.options.__file="awsImage.vue";e["a"]=h.exports}}]);